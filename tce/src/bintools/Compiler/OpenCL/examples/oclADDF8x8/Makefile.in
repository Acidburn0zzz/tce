TCECC=@LLVMCC@

CPPFLAGS=-I@top_builddir@/include
CFLAGS=-O3
LDFLAGS=-L@top_builddir@/lib/CL

WARP_SIZE=2

SCHEDFLAGS=--opencl-max-parallel-wi-count=$(WARP_SIZE) \
           --unroll-threshold=0 --if-conversion-threshold=1000 --inline-threshold=1000 \
           --primary-functions=___KERNEL_8_8_1_ADDF8x8,__Z30__tce_opencl_trampoline_DCT8x8PPviPKjS2_ \
		   --no-rename-registers --dump-ddgs-dot

vpath % @srcdir@

.PHONY: all clean

all: ADDF8x8-default.tpef

ADDF8x8-%.tpef: @srcdir@/../%.adf ADDF8x8.cl oclADDF8x8.cpp
	$(TCECC) -a $< $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) -loclhost -o $@ \
	$(filter-out %.adf, $^) \
	$(SCHEDFLAGS)

clean:
	rm -f ADDF8x8-*.tpef
